---
sidebar_position: 7
---

# How beginWork works

Begin works is the function in React that will render your application.

We invoked it in the previous section like this:

```tsx
// simplified
function performUnitOfWork(unitOfWork: Fiber): void {
  const current = unitOfWork.alternate;

  // unitOfWork: the original fiber
  // current: the original fiber's alternate: the current ongoing render
  // renderLanes: were assigned in prepareFreshStack
  // highlight-next-line
  const next = beginWork(current, unitOfWork, renderLanes);
  
  // ... rest of the code
}

```

## Signature
`beingWork` is defined [as follows:](https://github.com/facebook/react/blob/eaa696876ee40bb048727aefe995be1bbb7384a8/packages/react-reconciler/src/ReactFiberBeginWork.js#L4002)

```tsx
function beginWork(
  current: Fiber | null, // wip.alternate
  workInProgress: Fiber, // wip
  renderLanes: Lanes,
): Fiber | null { /* [Not Native Code] */ }
```

It returns the next unit of work, we will see how it calculates it.

## Implementation

React components can be rendered several times in their lifetime, the `alternate`
is created for each render that occurs as a draft of the next version of the
component's output.

`beginWork`'s simplified version looks like this:

```tsx
function beginWork(
  current,
  wip,
  lanes
) {
  if (current !== null) {
    // this is a pending incomplete render
  } else {
    
  }
}
```

### Attempt early bailout if applicable

So `beginWork` will first check if we deal with an incomplete render (probably
interrupted by a renderPhase update, or even sync effects...), this is not the
case when coming from `root.render()` but we will get into it anyway. Because
this code path is visited at every render.

:::note
Even when coming from `root.render`, the `HostRoot` fiber will have the
`alternate` created since we created it when preparing a fresh stack. But not
the rest of the tree.
:::

So, when the alternate already exists:

- Reference the `oldProps` (`alternate.memoizedProps`) and `newProps` (
  `wip.pendingProps`):
  ```tsx
  const oldProps = current.memoizedProps;
  const newProps = workInProgress.pendingProps;
  ```

- If the `oldProps` and `newProps` aren't the same (meaning a triggered render 
  from the parent component) or the [legacy context changed,](https://github.com/facebook/react/blob/eaa696876ee40bb048727aefe995be1bbb7384a8/packages/react-reconciler/src/ReactFiberBeginWork.js#L4032)
  then it mark the component as did receive update.
- When props did change, it will check if there is a scheduled update or some
  context changed:
  - The component received an update means that the alternate `lanes` intersect
    with the `renderLanes` (do a pause a think about it).
  - Contexts are stored as `fiber.dependencies` in a linked list, so it will
    iterate through all of them and compare the context's value.
  
  When nothing changed, React will attempt to [bail out the render](https://github.com/facebook/react/blob/eaa696876ee40bb048727aefe995be1bbb7384a8/packages/react-reconciler/src/ReactFiberBeginWork.js#L3788)
  for this component and its children if possible. We will see the bailout
  in its dedicated section.
- When the `alternate` is `null`, then it will mark the component as it did not
  receive an update (which is pretty normal), then it will perform some
  hydration ID related stuff. This is out of our scope for now.

Let's put the previous words into code:

```tsx
// simplified
function beginWork(
  current: Fiber | null,
  workInProgress: Fiber,
  renderLanes: Lanes,
) {
  if (current !== null) {
    const oldProps = current.memoizedProps;
    const newProps = workInProgress.pendingProps;
    
    if (oldProps !== newProps || hasLegacyContextChanged()) {
      didReceivedUpdate = true;
    } else {
      if (
        hasScheduledUpdateOrContext(current, renderLanes) &&
        // more on this later
        (workInProgress.flags & DidCapture === NoFlags)
      ) {
        didReceiveUpdate = false;
        return attemptEarlyBailoutIfNoScheduledUpdate(
          current,
          workInProgress,
          renderLanes,
        );
      }
    }
  } else {
    didReceiveUpdate = false;
    // out of our scope code
  }
}
```

:::note
As a recap, `beginWork` would attempt to bail out the work if not needed.
This is not the only work bailout on React, we will see it several times again.
:::

### Render the components
Right next, React will perform a huge switch case over `workInProgress.tag`.


