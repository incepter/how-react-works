---
sidebar_position: 7
---

# ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†ã®ä»•çµ„ã¿

å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (`how begin work works`) ã§ã¯ã€å¤§ããªæœªèª¬æ˜ã® switch æ–‡ãŒæ®‹ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ãã®è©³ç´°ã‚’æ¢æ±‚ã—ã¾ã™ã€‚

[ä½œæ¥­ã‚’å§‹ã‚ã‚‹å‰ã«](https://github.com/facebook/react/blob/eaa696876ee40bb048727aefe995be1bbb7384a8/packages/react-reconciler/src/ReactFiberBeginWork.js#L4098) ã“ã® switch æ–‡ã‚’å†ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

```tsx
// simplified
function beginWork(
  current: Fiber | null,
  workInProgress: Fiber,
  renderLanes: Lanes
) {
  // previous code

  switch (
    workInProgress.tag
    // case FunctionComponent:
    // case ClassComponent:
    // case IndeterminateComponent:
    // case HostRoot:
    // case HostPortal:
    // case HostComponent:
    // case HostText:
    // case Fragment:
    // case Mode:
    // case ContextConsumer:
    // case ContextProvider:
    // case ForwardRef:
    // case Profiler:
    // case SuspenseComponent:
    // case MemoComponent:
    // case SimpleMemoComponent:
    // case LazyComponent:
    // case IncompleteClassComponent:
    // case DehydratedFragment:
    // case SuspenseListComponent:
    // case ScopeComponent:
    // case OffscreenComponent:
    // case LegacyHiddenComponent:
    // case CacheComponent:
    // case TracingMarkerComponent:
    // case HostHoistable:
    // case HostSingleton:
  ) {
  }

  throw new Error("...");
}
```

:::note
ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯å„ work tag ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ãŒã€éå¸¸ã«é‡è¦ãªå‰æçŸ¥è­˜ã¨ã—ã¦ã€å­è¦ç´ ã® reconcile å‡¦ç†ä¸­ã«æ¬¡ã®å­è¦ç´ ã® alternateï¼ˆ= `workInProgress`ï¼‰ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç†è§£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

åˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚ã€`workInProgress`ã¯ alternate ã¨ãªã‚Šã€ã“ã®æ™‚ç‚¹ã§ã®`current`ã¯ null ã§ã™ã€‚ã—ã‹ã—æ›´æ–°æ™‚ã«ã¯`current`ãŒå®šç¾©ã•ã‚Œã¾ã™ã€‚

æœ€åˆã® fiber ãŒã„ã¤ä½œæˆã•ã‚Œã‚‹ã®ã‹ç–‘å•ã«æ€ã†å ´åˆã€å‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ³¨è¨˜ã«`root.render()`ã‹ã‚‰æ¥ãŸéš›ã® 3 ç•ªç›®ã® fiber ä½œæˆã«ã¤ã„ã¦è¨€åŠã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯`render`ãŒå—ã‘å–ã£ãŸæœ€åˆã®å­ã® alternate ã¨ãªã‚Šã¾ã™ã€‚
:::

## WorkTag ã«åŸºã¥ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ä»•çµ„ã¿

`beginWork`ã¯ fiber ã®`tag`ã«ç‰¹åŒ–ã—ãŸãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°ã¸å‡¦ç†ã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚

### Function Component ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ä»•çµ„ã¿

æœ€ã‚‚ä¸€èˆ¬çš„ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆæ–¹æ³•ã§ã‚ã‚‹`function components`ã‹ã‚‰èª¬æ˜ã‚’å§‹ã‚ã¾ã™ã€‚

```tsx
switch (workInProgress.tag) {
  case FunctionComponent: {
    // 1 Componentã¯é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    //   workInProgressã¯ã“ã®ãƒ„ãƒªãƒ¼ã®alternate
    //   current === nullã¯åˆå›ãƒã‚¦ãƒ³ãƒˆã‚’æ„å‘³ã™ã‚‹
    const Component = workInProgress.type;
    // 2 pendingPropsã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒ¬ãƒ³ãƒ€ãƒ¼ã™ã‚‹æ¬¡ã®props
    const unresolvedProps = workInProgress.pendingProps;
    // 3 Componentã®å‹ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã«defaultPropsã‚’è§£æ±º
    const resolvedProps =
      workInProgress.elementType === Component
        ? unresolvedProps
        : resolveDefaultProps(Component, unresolvedProps);
    // 4 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒ¼
    return updateFunctionComponent(
      current, // ç¾åœ¨ã®ãƒ¬ãƒ³ãƒ€ãƒ¼æ¸ˆã¿Fiber
      workInProgress, // ãã®alternateï¼ˆæœ€åˆã¯currentã‚ˆã‚Šå…ˆã«ä½œæˆã•ã‚Œã‚‹ï¼‰
      Component, // é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
      resolvedProps, // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®props
      renderLanes // ãƒ¬ãƒ³ãƒ€ãƒ¼lane
    );
  }
}
```

ã“ã‚ŒãŒé–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†ã§ã™ã€‚[`updateFunctionComponent`](https://github.com/facebook/react/blob/eaa696876ee40bb048727aefe995be1bbb7384a8/packages/react-reconciler/src/ReactFiberBeginWork.js#L1092)ã«å…¥ã‚‹å‰ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’åˆ†è§£ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

1. æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã§`workInProgress` fiber ã®`type`ã‚’å‚ç…§
2. `pendingProps`ã¯æ¬¡ã« defaultProps ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚`unresolvedProps`ã¨å‘¼ã°ã‚Œã‚‹
3. `workInProgress.elementType`ãŒ`workInProgress.type`ã¨ç•°ãªã‚‹å ´åˆã€`workInProgress.type`ã‹ã‚‰ default props ã‚’è§£æ±º
4. `updateFunctionComponent`ã‚’é€šã˜ã¦å®Ÿéš›ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ä½œæ¥­ã‚’è¿”ã™

:::note
é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆå›ãƒã‚¦ãƒ³ãƒˆã¯`FunctionComponent`ã‚±ãƒ¼ã‚¹ã‚’é€šéã›ãšã€`IndeterminateComponent`ã‚’çµŒç”±ã—ã¾ã™ã€‚

React ãŒ`Element`ã‹ã‚‰`Fiber`ã‚’ä½œæˆã™ã‚‹éš›ã€æœ€åˆã¯[`IndeterminateComponent`](https://github.com/facebook/react/blob/eaa696876ee40bb048727aefe995be1bbb7384a8/packages/react-reconciler/src/ReactFiber.js#L501)ã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚Œã€ãƒ¬ãƒ³ãƒ€ãƒ¼æ™‚ã«`FunctionComponent`ã¨ã—ã¦å†ãƒãƒ¼ã‚¯ã•ã‚Œã‚‹ãŸã‚ã§ã™ï¼ˆå¾Œè¿°ã®é–¢é€£ã‚±ãƒ¼ã‚¹ã§èª¬æ˜ã—ã¾ã™ï¼‰ã€‚
:::

é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã™ã‚‹`updateFunctionComponent`ã®[å®Ÿè£…](https://github.com/facebook/react/blob/eaa696876ee40bb048727aefe995be1bbb7384a8/packages/react-reconciler/src/ReactFiberBeginWork.js#L1092)ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```tsx
// simplified
function updateFunctionComponent(
  current: null | Fiber, // ç¾åœ¨ã®ãƒ¬ãƒ³ãƒ€ãƒ¼æ¸ˆã¿Fiber
  workInProgress: Fiber, // alternateï¼ˆé€²è¡Œä¸­ã®ä½œæ¥­ï¼‰
  Component: any, // é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  nextProps: any, // æ–°ã—ã„props
  renderLanes: Lanes // ãƒ¬ãƒ³ãƒ€ãƒ¼laneï¼ˆDefaultLaneã€SyncLaneã€Transition...ï¼‰
): Fiber | null {
  // [...] ãƒ¬ã‚¬ã‚·ãƒ¼ãªcontextç®¡ç†

  // 1
  // ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§contextã‚’èª­ã¿å–ã‚‹æº–å‚™
  prepareToReadContext(workInProgress, renderLanes);

  // 2
  // ã“ã®é–¢æ•°ã‚’æœ€åˆã‹ã‚‰å¾…ã¡æœ›ã‚“ã§ã„ãŸã§ã—ã‚‡ã† ğŸ˜…
  // æ³¨: Indeterminateã‹ã‚‰é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒ¼ã™ã‚‹å ´åˆã‚‚ã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™
  // highlight-next-line
  let nextChildren = renderWithHooks(
    current,
    workInProgress,
    Component,
    nextProps,
    // ã“ã‚Œã¯ç„¡è¦–ã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“
    // æ°—ã«ãªã‚Šã¾ã™ã‹ï¼Ÿã“ã‚Œã¯é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç¬¬2å¼•æ•°ã§ã™ ğŸ™‚
    context,
    renderLanes
  );

  if (current !== null && !didReceiveUpdate) {
    // highlight-next-line
    bailoutHooks(current, workInProgress, renderLanes);
    // highlight-next-line
    return bailoutOnAlreadyFinishedWork(current, workInProgress, renderLanes);
  }

  workInProgress.flags |= PerformedWork;
  // 3
  // ä»¥å‰ã«ã‚‚è¦‹ãŸå‡¦ç†ã§ã™ ğŸ˜‰ ãã—ã¦ã“ã‚Œã‹ã‚‰ä½•åº¦ã‚‚è¦‹ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™
  // highlight-next-line
  reconcileChildren(current, workInProgress, nextChildren, renderLanes);
  return workInProgress.child;
}
```

ä¸Šè¨˜ã®é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ä¸»ãªã‚¹ãƒ†ãƒƒãƒ—ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

#### Prepare to read context

é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹éš›ã€`useContext`ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦æœ€ã‚‚è¿‘ã„`ReactContext`ã‚’ subscribe ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

`useContext`ã®å‘¼ã³å‡ºã—ã¯ã€å®Ÿéš›ã«`fiber.dependencies`ãƒªãƒ³ã‚¯ãƒªã‚¹ãƒˆã«ç›®çš„ã® context ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‰ã€[React ã¯](https://github.com/facebook/react/blob/540bab085d571789f4562565eebfd0db9f36345c/packages/react-reconciler/src/ReactFiberNewContext.js#L686)
[ã“ã®ãƒªã‚¹ãƒˆã‚’ç©ºã«ã—](https://github.com/facebook/react/blob/540bab085d571789f4562565eebfd0db9f36345c/packages/react-reconciler/src/ReactFiberNewContext.js#L707)ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ä¸­ã«å†åº¦ã‚¹ã‚¿ãƒƒã‚¯ã—ã¾ã™ï¼ˆReact ã¯[subscribe ã™ã‚‹ context ã‚’å¤‰æ›´ã—ã¦ã‚‚æ°—ã«ã—ã¾ã›ã‚“](https://codesandbox.io/s/agitated-fire-klzj6c?file=/src/App.js:169-185)ï¼‰ã€‚

#### render with hooks

æœ€åˆã«ã‚·ã‚°ãƒãƒãƒ£ã¨å‘¼ã³å‡ºã—æ–¹æ³•ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š

```tsx
export function renderWithHooks<Props, SecondArg>(
  current: Fiber | null,
  workInProgress: Fiber,
  Component: (p: Props, arg: SecondArg) => any,
  props: Props,
  secondArg: SecondArg,
  nextRenderLanes: Lanes
): any {
  // [Not Native Code]
}

// ã“ã®ã‚ˆã†ã«å‘¼ã³å‡ºã•ã‚Œã¾ã™
let nextChildren = renderWithHooks(
  current,
  workInProgress,
  Component,
  nextProps,
  context,
  renderLanes
);
```

[å®Ÿè£…ã®è¦ç‚¹](https://github.com/facebook/react/blob/d6dcad6a8beaeec0513a9851d1e0fe1181932360/packages/react-reconciler/src/ReactFiberHooks.js#L494)ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```tsx
// simplified
export function renderWithHooks<Props, SecondArg>(
  current: Fiber | null,
  workInProgress: Fiber,
  Component: (p: Props, arg: SecondArg) => any,
  props: Props,
  secondArg: SecondArg,
  nextRenderLanes: Lanes
): any {
  // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…éƒ¨çŠ¶æ…‹
  renderLanes = nextRenderLanes;
  currentlyRenderingFiber = workInProgress;

  // workInProgressã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆalternateï¼‰
  workInProgress.memoizedState = null;
  workInProgress.updateQueue = null;
  workInProgress.lanes = NoLanes;

  // 1
  // React Hooksã«ãŠã„ã¦éå¸¸ã«é‡è¦ãªã‚¹ãƒ†ãƒƒãƒ—
  // highlight-next-line
  ReactCurrentDispatcher.current =
    // åˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚
    current === null || current.memoizedState === null
      ? HooksDispatcherOnMount
      : HooksDispatcherOnUpdate;

  const shouldDoubleRenderInDev = __DEV__ && workInProgress.mode & StrictMode;

  // 2
  // highlight-next-line
  let children = Component(props, secondArg);

  // 3
  if (didScheduleRenderPhaseUpdateDuringThisPass) {
    // highlight-next-line
    children = renderWithHooksAgain(
      workInProgress,
      Component,
      props,
      secondArg
    );
  }

  // 4
  if (shouldDoubleRenderInDev) {
    // highlight-next-line
    children = renderWithHooksAgain(
      workInProgress,
      Component,
      props,
      secondArg
    );
  }

  // 5
  finishRenderingHooks(current, workInProgress, Component);

  // 6
  return children;
}
```

ä¸»ãªã‚¹ãƒ†ãƒƒãƒ—ã®èª¬æ˜ï¼š

1. é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã®æœ€åˆã®é‡è¦ãªå‡¦ç†ã¯é©åˆ‡ãª dispatcher ã®è¨­å®šï¼š

   - åˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚ã¯[`HooksDispatcherOnMount`](https://github.com/facebook/react/blob/d6dcad6a8beaeec0513a9851d1e0fe1181932360/packages/react-reconciler/src/ReactFiberHooks.js#L3357)ã‚’ä½¿ç”¨
   - æ›´æ–°æ™‚ã¯[`HooksDispatcherOnUpdate`](https://github.com/facebook/react/blob/d6dcad6a8beaeec0513a9851d1e0fe1181932360/packages/react-reconciler/src/ReactFiberHooks.js#L3395)ã‚’ä½¿ç”¨

   dispatcher ã«ã¤ã„ã¦ã®è©³ç´°ã¯ Hooks ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§èª¬æ˜ã—ã¾ã™ãŒã€ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ dispatcher ã«ã¤ã„ã¦ç†è§£ã™ã¹ãé‡è¦ãªç‚¹ã¯ã€ã™ã¹ã¦ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸ hook ãŒæ¬¡ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã†ã“ã¨ã§ã™ï¼š
   ç¾åœ¨ã® dispatcherï¼ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‰ã« React ãŒè¨­å®šã—ãŸã‚‚ã®ï¼‰ã‚’è§£æ±ºã—ã€dispatcher ã‹ã‚‰åŒã˜é–¢æ•°ã‚’è¿”ã—ã¾ã™ã€‚

   ```tsx
   // ã»ã¼å…¨ã¦ã®hookã¯ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã„ã¾ã™
   function useSomeHook() {
     const dispatcher = ReactCurrentDispatcher.current;
     return dispatcher.useSomeHook();
   }
   ```

2. The second step is rendering the actual component and taking its return:

   ```tsx
   let children = Component(props, secondArg);
   ```

   `secondArg`ã¯ã“ã®ãƒ„ãƒªãƒ¼ã®`fiberRoot`ã®`context`ï¼ˆã¾ãŸã¯`pendingContext`ï¼‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã™ã€‚

   :::note
   ã“ã®æ™‚ç‚¹ã§å…¨ã¦ã® hook ãŒå®Ÿè¡Œã•ã‚Œã¾ã™
   :::

3. ç¾åœ¨ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ**ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ•ã‚§ãƒ¼ã‚ºæ›´æ–°**ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã—ãŸã‹è¿½è·¡ã—ã€è©²å½“ã™ã‚‹å ´åˆã¯å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼š
   [`renderWithHooksAgain`](https://github.com/facebook/react/blob/d6dcad6a8beaeec0513a9851d1e0fe1181932360/packages/react-reconciler/src/ReactFiberHooks.js#L765)ã¯ãƒã‚¹ãƒˆã—ãŸæ›´æ–°ã‚„ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã€ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ•ã‚§ãƒ¼ã‚ºæ›´æ–°ãŒãªããªã‚‹ã¾ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚

   renderWithHooksAgain ã®ç›®çš„ã¯ã€ãƒã‚¹ãƒˆã—ãŸæ›´æ–°ã‚„ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’è¿½è·¡ã—ã€ä¸€éƒ¨ã® hooks ã®å‹•ä½œã‚’å¤‰æ›´ã™ã‚‹ç•°ãªã‚‹ dispatcher ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã™ï¼ˆè©³ç´°ã¯ hooks ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§èª¬æ˜ã—ã¾ã™ï¼‰ã€‚

   ```tsx
   function renderWithHooksAgain<Props, SecondArg>(
     workInProgress: Fiber,
     Component: (p: Props, arg: SecondArg) => any,
     props: Props,
     secondArg: SecondArg
   ): any {
     let numberOfRerenders = 0;
     let children;
     do {
       // thenablesã¨use() hookã«é–¢é€£ã™ã‚‹ã‚³ãƒ¼ãƒ‰
       didScheduleRenderPhaseUpdateDuringThisPass = false;

       if (numberOfReRenders >= RE_RENDER_LIMIT) {
         // highlight-next-line
         throw new Error(
           "Too many re-renders. React limits the number of renders to prevent " +
             "an infinite loop."
         );
       }

       numberOfReRenders += 1;
       currentHook = null;
       workInProgressHook = null;
       workInProgress.updateQueue = null;

       // highlight-next-line
       ReactCurrentDispatcher.current = __DEV__
         ? HooksDispatcherOnRerenderInDEV
         : HooksDispatcherOnRerender;

       // highlight-next-line
       children = Component(props, secondArg);
     } while (didScheduleRenderPhaseUpdateDuringThisPass);

     return children;
   }
   ```

   renderWithHooksAgain ã¯ã€ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ•ã‚§ãƒ¼ã‚ºæ›´æ–°ãŒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚Œãªããªã‚‹ã¾ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ç¶šã‘ã¾ã™ã€‚

4. åŒæ§˜ã«ã€`StrictMode`ãŒæœ‰åŠ¹ãªå ´åˆã€åˆ¥ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚`renderWithHooksAgain`ã‚’å†åº¦å‘¼ã³å‡ºã—ã¾ã™
5. [`finishRenderingHooks`é–¢æ•°](https://github.com/facebook/react/blob/d6dcad6a8beaeec0513a9851d1e0fe1181932360/packages/react-reconciler/src/ReactFiberHooks.js#L623)ã®å‘¼ã³å‡ºã—ï¼š
   ```tsx
   finishRenderingHooks(current, workInProgress, Component);
   ```
   ã“ã®é–¢æ•°ã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
   1. `ReactCurrentDispatcher`ã‚’`ContextOnlyDispatcher`ã«ãƒªã‚»ãƒƒãƒˆ
   2. hooks å¤‰æ•°ã®ãƒªã‚»ãƒƒãƒˆï¼ˆcurrentHookã€wipHookï¼‰
   3. thenable ã¨ use çŠ¶æ…‹ã®ãƒªã‚»ãƒƒãƒˆ
   4. ä½¿ç”¨ã•ã‚ŒãŸ hooks ãŒå°‘ãªã„å ´åˆã«ã‚¨ãƒ©ãƒ¼ã‚’é€å‡º
6. `renderWithHooks`ã®æœ€çµ‚ã‚¹ãƒ†ãƒƒãƒ—ã§ç”Ÿæˆã•ã‚ŒãŸ`children`ã‚’è¿”å´ï¼š
   ```tsx
   return children;
   ```

#### Reconcile children

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦æ¬¡ã®å­è¦ç´ ã‚’å–å¾—ã—ãŸå¾Œã€å‰ã®ãƒ„ãƒªãƒ¼ã®å­è¦ç´ ã¨ã® reconciliation ã‚’è¡Œã†ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚

```tsx
let nextChildren = renderWithHooks(...);

reconcileChildren(current, workInProgress, nextChildren, renderLanes);

return workInProgress.child;
```

å‰è¿°ã®ã‚ˆã†ã«ã€reconcile children ã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆä¸­ã‹æ›´æ–°ä¸­ã‹ã«å¿œã˜ã¦å‡¦ç†ã‚’é©åˆ‡ãª reconciliation é–¢æ•°ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚

`reconcileChildren`ã®ç›®çš„ã¯ã€æ¬¡ã«å‡¦ç†ã•ã‚Œã‚‹æœ€åˆã®å­è¦ç´ ã®`alternate`ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã™ã€‚

ã“ã®`child` fiber ãŒ null ã®å ´åˆï¼ˆç¾åœ¨ã®ãƒ„ãƒªãƒ¼ã®æœ€ä¸‹éƒ¨ã«åˆ°é”ã—ãŸå ´åˆï¼‰ã€`performUnitOfWork`ã‹ã‚‰è¦šãˆã¦ã„ã‚‹ã‚ˆã†ã«ã€å‡¦ç†ã™ã‚‹`next` fiber ãŒ`null`ã«ãªã‚‹ã¨`completeWork`ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

ä»¥ä¸ŠãŒã€React å†…éƒ¨ã§ã®é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†ã®ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã®æµã‚Œã§ã™ã€‚

### How rendering Class Components works

import TBD from "./components/TBDBanner"
<TBD />

### How rendering Indeterminate Component works

<TBD />

### How rendering Host Root works

<TBD />

### How rendering Host Portal works

<TBD />

### How rendering Host Component works

<TBD />

### How rendering Host Text works

<TBD />

### How rendering Fragment works

<TBD />

### How rendering Mode works

<TBD />

### How rendering Context Consumer works

<TBD />

### How rendering Context Provider works

<TBD />

### How rendering Forward Ref works

<TBD />

### How rendering Profiler works

<TBD />

### How rendering Suspense works

<TBD />

### How rendering Memo Component works

<TBD />

### How rendering Lazy Component works

<TBD />

### How rendering Incomplete Class Component works

<TBD />

### How rendering Dehydrated Fragment works

<TBD />

### How rendering Suspense List works

<TBD />

### How rendering Scope Component works

<TBD />

### How rendering Offscreen Component works

<TBD />

### How rendering Legacy Hidden Component works

<TBD />

### How rendering Cache Component works

<TBD />

### How rendering Tracing Marker Component works

<TBD />

### How rendering Host Hoistable works

<TBD />

### How rendering Host Singleton works

<TBD />
